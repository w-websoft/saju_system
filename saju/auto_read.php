<?php
if (!defined('_GNUBOARD_')) exit;
function saju_auto_reading($row){
  $y = (int)substr($row['birth_ymd'],0,4);
  $m = (int)substr($row['birth_ymd'],4,2);
  $d = (int)substr($row['birth_ymd'],6,2);
  $gender = $row['gender'];
  $has_time = ($row['birth_time']!==''); $night = $has_time ? ((int)$row['birth_time']>=21 || (int)$row['birth_time']<=5) : false;
  $kw = ['성격'=>[],'금전'=>[],'관계'=>[],'건강'=>[],'종합'=>[]];

  if(in_array($m,[3,4,5])){ $kw['성격'][]='겉은 부드럽지만 의지가 분명합니다'; $kw['관계'][]='정이 많아 사람 일에 쉽게 흔들립니다'; }
  elseif(in_array($m,[6,7,8])){ $kw['성격'][]='자존심이 강하고 추진력이 좋습니다'; $kw['건강'][]='열이 올라 수면·혈압 관리 필요'; }
  elseif(in_array($m,[9,10,11])){ $kw['성격'][]='이성적이며 판단이 빠르나 고집이 드러납니다'; $kw['금전'][]='수익·지출 편차 큼 → 지키는 법 중요'; }
  else { $kw['성격'][]='내면이 예민하고 직관이 강합니다'; $kw['건강'][]='한기·소화·순환 유의'; }

  if($night){ $kw['성격'][]='겉보다 속이 깊고 혼자 정리 시간이 필요'; $kw['관계'][]='오해 방지 위해 기록이 도움'; }
  if(($m+$d)%2==0){ $kw['금전'][]='벌 기회가 잦으나 지출·손실 동반 → 현금흐름 표준화'; }
  else { $kw['금전'][]='작게 꾸준히 쌓기 유리, 큰 베팅은 위험'; }
  if($gender=='M'){ $kw['관계'][]='리드 성향 강함 → 충돌 시 한 발 물러섬이 복'; }
  else { $kw['관계'][]='배려가 많아 마음소모 큼 → 선 긋기·휴식 필요'; }

  $age = (int)date('Y') - $y;
  if($age<30) $kw['종합'][]='학습·경험의 폭을 넓힐수록 길이 트입니다';
  elseif($age<45) $kw['종합'][]='기복 큰 시기, 선택과 집중으로 전환점';
  else $kw['종합'][]='정리와 안정이 핵심, 불필요한 인연·지출 절감';

  $out=[];
  $out[]="**기본 성향**\n- ".implode(' / ', $kw['성격']);
  $out[]="**금전 운**\n- ".implode(' / ', $kw['금전'])."\n- 돈을 버는 것 못지않게 *지키는 시스템*이 중요합니다";
  $out[]="**대인 관계**\n- ".implode(' / ', $kw['관계'])."\n- 감정보다 기록·원칙이 분쟁을 줄입니다";
  $out[]="**건강 힌트**\n- ".implode(' / ', ($kw['건강']?:['과로·수면·위장케어 루틴화']));
  $out[]="**종합**\n- ".implode(' / ', $kw['종합'])."\n- 파도는 있지만 결국 헤쳐 나가는 힘이 있습니다";
  return implode("\n\n", $out);
}
